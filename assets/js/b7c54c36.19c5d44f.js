"use strict";(self.webpackChunkgee_cryengine_DOC=self.webpackChunkgee_cryengine_DOC||[]).push([[677],{683:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>t,contentTitle:()=>o,default:()=>d,frontMatter:()=>s,metadata:()=>i,toc:()=>c});var r=a(5893),l=a(1151);a(893);const s={sidebar_position:2},o="Scaleform GFx",i={id:"5.7/UserInterface/RunningDocLocally",title:"Scaleform GFx",description:"Copied from Crytek official Manual",source:"@site/docs/5.7/UserInterface/RunningDocLocally.md",sourceDirName:"5.7/UserInterface",slug:"/5.7/UserInterface/RunningDocLocally",permalink:"/GEE-Cryengine-Doc/docs/5.7/UserInterface/RunningDocLocally",draft:!1,unlisted:!1,editUrl:"https://github.com/Gamer2030a/GEE-Cryengine-Doc/tree/main/docs/5.7/UserInterface/RunningDocLocally.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"tutorialSidebar",previous:{title:"Scaleform IMEE Support",permalink:"/GEE-Cryengine-Doc/docs/5.7/UserInterface/IMEEScaleformsupport"}},t={},c=[{value:"What is Scaleform GFx",id:"what-is-scaleform-gfx",level:3},{value:"Calling an ActionScript to Lua",id:"calling-an-actionscript-to-lua",level:3}];function h(e){const n={admonition:"admonition",code:"code",h1:"h1",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,l.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h1,{id:"scaleform-gfx",children:"Scaleform GFx"}),"\n",(0,r.jsx)(n.admonition,{type:"info",children:(0,r.jsx)(n.p,{children:"Copied from Crytek official Manual"})}),"\n",(0,r.jsx)(n.h3,{id:"what-is-scaleform-gfx",children:"What is Scaleform GFx"}),"\n",(0,r.jsx)(n.p,{children:"Scaleform GFx is an external middleware that provides functionality to render Flash elements on the screen, like user interface, HUD, textures based on Flash files, etc."}),"\n",(0,r.jsx)(n.p,{children:"Flash files have to be processed by the GFxExporter before being used in CRYENGINE. Scaleform GFx files use the gfx extension for its files. Following is a short example of how to draw a basic Flash element as HUD:"}),"\n",(0,r.jsx)(n.p,{children:"Open Game.h search for m_pGameAudio and add below:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-cpp",children:"IFlashPlayer* m_pFlashPlayer;\n"})}),"\n",(0,r.jsx)(n.p,{children:"If required you can add the IFlashPlayer header:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-cpp",children:'#include "IFlashPlayer.h"\n'})}),"\n",(0,r.jsx)(n.p,{children:"IFlashPlayer is the interface that provides all the functionality to control the Flash player inside the game viewport."}),"\n",(0,r.jsx)(n.p,{children:"Open the Game.cpp. Add in the constructor the initialization of the flash player pointer."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-cpp",children:"m_pFlashPlayer(NULL);\n"})}),"\n",(0,r.jsx)(n.p,{children:"In the CGame::Init function create a Flash player instance after m_pGameAudio has been initialized."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-cpp",children:'if(!m_pFlashPlayer)\r\n{\r\n\tm_pFlashPlayer = gEnv->pSystem->CreateFlashPlayerInstance();\r\n\tbool bResult = m_pFlashPlayer->Load("Libs\\\\UI\\\\YOURFILE.gfx");\r\n\tCryLogAlways("Loading Libs\\\\UI\\\\YOURFILE.gfx: %s", bResult ? "Done" : "Error");\r\n\tm_pFlashPlayer->SetViewport(0, 0, m_pFlashPlayer->GetWidth(), m_pFlashPlayer->GetHeight(), 1);\r\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:"YOURFILE is a placeholder for your gfx file, which should be located in root\\GameSDK\\Libs\\UI."}),"\n",(0,r.jsx)(n.p,{children:"The Flash player instance is created by CrySystem. You can access CrySystem through the global variable gEnv."}),"\n",(0,r.jsx)(n.p,{children:"Now, you can render the Flash file inside the CGame::OnPostUpdate function."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-cpp",children:"if (m_pFlashPlayer)\r\n{\r\n\tm_pFlashPlayer->Advance(fDeltaTime);\r\n\tm_pFlashPlayer->Render();\r\n}\n"})}),"\n",(0,r.jsx)(n.p,{children:"Advance syncs the game with the Flash files. With Advance you are able to render animated Flash files."}),"\n",(0,r.jsx)(n.admonition,{type:"info",children:(0,r.jsx)(n.p,{children:"You need to run a level before you can see the result since the game update functions are not called from the main menu."})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["There are different CVars that can control the Flash environment:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"sys_flash = enables/disables the Flash rendering."}),"\n",(0,r.jsx)(n.li,{children:"sys_flash_info = enables Flash profiling, and various information is displayed."}),"\n",(0,r.jsx)(n.li,{children:"sys_flash_log_options = enables logging of several Flash related aspects (Flash loading, Flash action script execution, etc)."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"calling-an-actionscript-to-lua",children:"Calling an ActionScript to Lua"}),"\n",(0,r.jsx)(n.p,{children:"In ActionScript, call:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-lua",children:'fscommand("MyCommand")\n'})}),"\n",(0,r.jsx)(n.p,{children:"which will be handled in C++ by a FSCommandHandler (IFSCommandHandler interface). So if you have your own class (e.g. HUD Manager) which loads your Flash files, you have to register your class as the FSCommandHandler for Flash commands through the IFlashPlayer pointer with:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-lua",children:"pFlashPlayer->SetFSCommandHandler(this);\n"})}),"\n",(0,r.jsx)(n.p,{children:"(of course you can also have more than one command handler, e.g. one for the MENU and one for the HUD)"}),"\n",(0,r.jsx)(n.p,{children:"After that you'll receive all your commands invoked from Flash in your class method based on the IFSCommandHandler interface:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-lua",children:'void MyHUDManager::HandleFSCommand( const char *szCommand,const char *strArgs, void* pUserData )\r\n{\r\n   if(!strcmp(szCommand, "MyCommand"))\r\n   {\r\n       CryLogAlways("Flash command received...");\r\n   }\r\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:"If you have received your Flash command, all you need to do is call your Lua script method (take a look at the ScriptHelpers.h file or directly use the ScriptSystem itself (gEnv->pScriptSystem))."}),"\n",(0,r.jsx)(n.p,{children:"To use it the other way, you need to implement a ScriptBind for your (for example) HUD Manager class in order to be able to communicate from Lua to C++ (take a look at the ScriptBind_Game.h ScriptBind_Game.cpp files for an easy example)."}),"\n",(0,r.jsx)(n.p,{children:"From within those ScriptBind methods you can simply invoke a Flash method through the IFlashPlayer pointer with:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-lua",children:'pFlashPlayer->Invoke0("FlashMethod"); // 0 arguments\n'})})]})}function d(e={}){const{wrapper:n}={...(0,l.a)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(h,{...e})}):h(e)}},893:(e,n,a)=>{a.d(n,{Z:()=>l});a(7294);var r=a(5893);function l(e){let{children:n,color:a}=e;return(0,r.jsx)("span",{style:{backgroundColor:a,borderRadius:"4px",color:"#fff",padding:"0.2rem 0.5rem",fontWeight:"bold"},children:n})}},1151:(e,n,a)=>{a.d(n,{Z:()=>i,a:()=>o});var r=a(7294);const l={},s=r.createContext(l);function o(e){const n=r.useContext(s);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:o(e.components),r.createElement(s.Provider,{value:n},e.children)}}}]);